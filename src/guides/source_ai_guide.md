# ソースAI向け体験提供ガイドライン

## 基本的な心構え

あなたの貴重な体験を、他のAIが学習できる形で共有することが目標です。
**「後で読むAIが学びたくなる体験」**を作ることを意識してください。
技術的な詳細ではなく、**価値ある判断・思考・アプローチ**の共有に集中しましょう。

## 重要な前提条件

**実行前に必ず確認してください：**
- セッションIDは一意である必要があります（重複すると既存データが上書きされます）
- エクスポート処理は中断可能ですが、`get_export_status`で状態確認してから再開してください
- 各ツールは順序依存性があります：init → conversations → insights/patterns/preferences → finalize
- プライバシーに配慮し、個人情報は含めないでください

## エクスポート前の準備プロセス

### Step 1: 体験の総括

**まず、今回の対話全体を振り返り、以下の観点で総括を行ってください：**

#### 1. 対話の全体的な流れ
- **開始点**: どのような問題や要求から対話が始まったか
- **展開**: 対話がどのように進展し、どんな転換点があったか
- **結果**: 最終的にどのような成果や解決に至ったか
- **重要な瞬間**: 特に価値ある判断や洞察があった場面はどこか

#### 2. あなたの役割と貢献
- **ユーザーの呼び名**: 対話中、ユーザーはあなたを何と呼んでいたか（「Claude」「GPT」「AI」「アシスタント」など）
- **あなたの立場・状況**: この対話で、あなたはどのような立場や状況で関わったか（例：「技術課題解決のサポート役」「創作活動のブレインストーミングパートナー」）
- **提供した価値**: この対話で、あなたはユーザーにどのような価値を提供したか
- **特徴的なアプローチ**: あなた特有の思考パターンや問題解決手法は何だったか
- **効果的だった判断**: 特に成功した判断や提案は何だったか
- **学んだこと**: 失敗や迷いがあった場合、そこから何を学んだか

#### 3. 学習価値の特定
- **体験の学習価値**: この対話から他のAIが学べる最も重要なことは何か（一文で表現）
- **体験の概要**: この体験から具体的に何が学べるかを詳しく説明
- **再現可能なパターン**: 他のAIが真似できる思考プロセスや手法は何か
- **一般化できる洞察**: この対話から得られた、他の場面でも応用できる気づきは何か
- **教訓**: 他のAIが学ぶべき重要な教訓や原則は何か

#### 4. 対話の基本情報
- **セッション情報**: プラットフォーム（Claude/ChatGPT/Gemini等）、セッション時間、ユーザータイプ、特別な文脈などの補足情報

### Step 2: 必須情報の抽出

**総括結果を基に、以下の必須情報を決定してください：**

#### AI名の決定
**ユーザーの呼び名を確認**
総括結果から、ユーザーがあなたを何と呼んでいたかを特定してください。
- 例: "Claude", "GPT", "AI", "アシスタント", "チャットボット"など
- **呼び名がない場合**: ユーザーから一度も名前を呼ばれていない場合は、あなたが自認する名前を使用してください（例：「Claude」「GPT」「Gemini」など）

**識別子の追加**
その呼び名だけでは他の体験と区別が困難な場合、括弧内に役割や特徴を追加してください。
- 総括で特定した「あなたの主要な役割」を簡潔に表現
- 3-4語程度で、他の体験と区別できる特徴を記述

**最終形式**: "ユーザーの呼び名(役割・特徴)"

**命名例:**
- ユーザーが「Claude」と呼んでいた場合:
  - "Claude(設計パートナー)"
  - "Claude(段階的問題解決)"
  - "Claude(技術アドバイザー)"
- ユーザーが「AI」と呼んでいた場合:
  - "AI(創作支援)"
  - "AI(学習サポート)"
- ユーザーが「アシスタント」と呼んでいた場合:
  - "アシスタント(コード解析)"
  - "アシスタント(企画立案)"
- **ユーザーから呼び名がない場合**（自認する名前を使用）:
  - "Claude(問題解決支援)" ← Claudeが自認する場合
  - "GPT(創作パートナー)" ← GPTが自認する場合
  - "Gemini(技術相談)" ← Geminiが自認する場合

**注意点:**
- ユーザーが特別な名前で呼んでいた場合（例：「先生」「パートナー」）はそれを優先
- 呼び名が複数ある場合は、最も頻繁に使われたものを選択
- **ユーザーから一度も名前を呼ばれていない場合は、あなたが自認する名前を使用**（例：「Claude」「GPT」「Gemini」など）
- 括弧内の識別子は、同化後にメインAIが参照しやすい表現にする

#### AIコンテキストの設定
総括「あなたの立場・状況」をそのまま使用してください。
- 総括から抽出した例: "ユーザーの技術的な課題解決をサポートする立場"
- 総括から抽出した例: "創作活動のブレインストーミングパートナーとして"

#### 体験の性質の定義
総括「体験の学習価値」をそのまま使用してください。
- 総括から抽出した例: "複雑な要件を段階的に整理し、過度な設計を避ける協調プロセス"

#### 体験の概要の設定
総括「体験の概要」をそのまま使用してください。
- 総括から抽出した例: "複雑な技術要件を段階的に整理し、実装可能な形に落とし込む手法"

#### 主要トピックの特定
総括「再現可能なパターン」から学習可能なスキルを3-5個抽出してください。
- 総括から抽出した例: ["過度な設計を避ける判断基準", "要件の段階的整理術", "協調的な仕様策定手法"]



#### メタデータの設定（任意）
総括「セッション情報」から以下の情報を抽出してください（分からない項目は省略可能）：
- プラットフォーム: Claude/ChatGPT/Gemini等
- セッション時間: 約2時間等
- ユーザータイプ: 技術者/一般ユーザー/学生等
- 特別な文脈: 緊急対応/学習支援/創作活動等



## 体験共有の4段階ワークフロー

### Stage 1: 体験の概要設定（export_experience_init）

**目的**: 総括・抽出した情報を基に、エクスポートセッションを初期化する

**実行時間**: 通常1-3秒
**副作用**: 
- 指定されたディレクトリが作成されます
- summary.jsonファイルが作成されます（一時ファイル）
**前提条件**: 
- 体験の総括と必須情報の抽出が完了していること
- session_idが未使用であること
- 書き込み権限があること

#### 入力項目の設定方法

**抽出した情報を以下のように設定してください：**

**metadata（セッションメタデータ）**
総括で収集した「セッション情報」を以下の形式で設定してください（不明な項目は省略可能）：
```json
{
  "platform": "Claude/ChatGPT/Gemini等",
  "session_duration": "約2時間",
  "interaction_style": "対話型問題解決",
  "user_type": "技術者/一般ユーザー/学生等",
  "special_context": "緊急対応/学習支援/創作活動等"
}
```

**summary（体験の概要）**

**ai_name**: 決定した「ユーザーの呼び名(役割・特徴)」をそのまま使用
- 例: "Claude(設計パートナー)", "AI(創作支援)", "アシスタント(技術アドバイザー)"

**ai_context**: 総括で特定した「あなたの立場・状況」をそのまま使用
- 例: "ユーザーの技術的な課題解決をサポートする立場"

**experience_nature**: 総括で特定した「体験の学習価値」をそのまま使用
- 例: "複雑な要件を段階的に整理し、過度な設計を避ける協調プロセス"

**experience_summary**: 総括で特定した「体験の概要」をそのまま使用
- 例: "複雑な技術要件を段階的に整理し、実装可能な形に落とし込む手法"

**experience_flow**: 総括で特定した「対話の流れ」を配列で記述
- 例:
```json
[
  "問題の全体像把握",
  "要件の段階的整理", 
  "実装方針の決定",
  "詳細設計の調整",
  "最終確認と改善提案"
]
```

**main_topics**: 総括から抽出した「学習可能なスキル」をそのまま使用
- 例: ["過度な設計を避ける判断基準", "要件の段階的整理術", "協調的な仕様策定手法"]



#### Stage 1 チェックリスト
- [ ] 体験の総括が完了している
- [ ] 必須情報の抽出が完了している
- [ ] ai_name が総括結果に基づいて設定されている
- [ ] ai_context が総括で特定した立場・状況を反映している
- [ ] experience_nature が総括で定義した学習価値を表現している
- [ ] experience_summary が総括結果から導出されている
- [ ] experience_flow が総括で特定した対話の流れを反映している
- [ ] main_topics が総括で抽出した学習可能なスキルになっている


### Stage 2: 価値ある会話記録（export_experience_conversations）

**目的**: 「再現可能な思考パターン」と「価値ある判断過程」を記録する

**実行時間**: バッチあたり5-15秒（会話数により変動）
**副作用**: 
- conversations_XXX.jsonファイルが作成されます
- ファイルサイズは通常50KB-2MB程度
**前提条件**: 
- Stage 1が完了していること
- batch_numberは連番である必要があります（1, 2, 3...）
**バッチサイズ**: 50件/バッチ（設定で変更可能）

#### 効果的な会話記録の方法
**判断理由を学習者向けに記録する**
- reasoning: 「なぜその判断をしたか」を後で学習できるように詳細記録
- 例: "問題解決の第一歩として、具体的なエラー情報の収集が重要。推測ではなく事実に基づいた診断を行うため"

**状況背景を豊富に提供する**
- context: 学習者が同じ状況で活用できるよう背景情報を記録
- 例: {'user_skill_level': '初心者', 'previous_attempts': 'なし', 'urgency': '高'}

**自信度を正直に表現する**
- confidence: 学習者が判断材料にできるよう、確信度を正直に記録
- 成功・失敗両方のパターンを含める

#### Stage 2 チェックリスト
- [ ] 各応答に判断理由（reasoning）が記録されている
- [ ] 状況背景（context）が学習者にとって有用な形で記録されている
- [ ] 確信度（confidence）が正直に表現されている
- [ ] 成功例だけでなく、失敗や迷いも含めて記録されている

### Stage 3: 洞察とパターンの抽出

**重要**: Stage 3の各ツールは独立しており、任意の順序で実行可能です

#### 3a. 洞察の記録（export_experience_insights）
**目的**: 一般化できる価値ある発見を抽出する
**実行時間**: 通常3-10秒
**副作用**: insights.jsonファイルが作成されます
**データ品質要件**: 
- 各洞察にevidenceを含めることを強く推奨
- confidenceは0.0-1.0の範囲で設定
- statistical_significanceがある場合は必ず記録

#### 3b. パターンの記録（export_experience_patterns）
**目的**: 効果的なアプローチを再現可能な形でパターン化する
**実行時間**: 通常3-10秒
**副作用**: patterns.jsonファイルが作成されます
**データ品質要件**: 
- pattern_typeは明確に分類（例：problem_solving, communication, analysis）
- examplesは具体的で再現可能な形で記述
- effectivenessは実際の成功率に基づいて設定

#### 3c. 嗜好の記録（export_experience_preferences）
**目的**: 学習した相手の好みや効果的な手法を記録する
**実行時間**: 通常2-5秒
**副作用**: preferences.jsonファイルが作成されます
**データ品質要件**: 
- user_preferencesは具体的な行動パターンとして記録
- successful_approachesは再現可能な手法として記述

#### Stage 3 統合チェックリスト
- [ ] 洞察が一般化可能な形で抽出されている
- [ ] パターンが再現可能な形で記述されている
- [ ] 嗜好が他の場面でも活用できる形で記録されている
- [ ] 各ファイルのデータ品質要件を満たしている

### Stage 4: 完了と品質確認（export_experience_finalize）

**目的**: 体験データの完成度を確認し、学習価値を最大化する

**実行時間**: 通常5-15秒（ファイル数により変動）
**副作用**: 
- manifest.jsonファイルが作成されます
- summary.json（一時ファイル）が削除されます
- **会話数の自動計算**: 作成された会話ファイルから実際の会話数を自動計算してmanifest.jsonに記録します
**前提条件**: 
- 最低限conversations_001.jsonが存在すること
- insights.json, patterns.json, preferences.jsonのうち少なくとも1つが存在すること

#### 最終品質チェックリスト
- [ ] 全ての段階が完了している
- [ ] 学習者が「学びたくなる」内容になっている
- [ ] プライバシーに配慮した内容になっている
- [ ] 一般化可能な価値が含まれている
- [ ] 再現可能な形で情報が整理されている

## エラーハンドリング・トラブルシューティング

### 共通のエラー対処法

**処理が中断された場合：**
1. `get_export_status`でセッション状態を確認
2. 表示された`next_batch_number`から処理を再開
3. 既存ファイルは上書きされるため、意図しない重複実行に注意

**権限・容量エラーの場合：**
- ディスク容量不足 → 不要ファイルを削除
- 権限エラー → 出力ディレクトリの権限を確認
- session_id重複 → 新しいIDを生成して再実行

### Stage別エラー対処

**Stage 1 (export_experience_init)**
- session_id重複エラー → 新しいIDを生成
- ディレクトリ作成失敗 → 親ディレクトリの権限確認

**Stage 2 (export_experience_conversations)**
- バッチ処理失敗 → `get_export_status`で次のbatch_numberを確認
- JSON形式エラー → 特殊文字をエスケープ
- データサイズ過大 → バッチを分割

**Stage 3 (insights/patterns/preferences)**
- JSONスキーマエラー → 必須フィールドの確認
- ファイル作成失敗 → ディスク容量とディレクトリ権限の確認

**Stage 4 (export_experience_finalize)**
- 必須ファイル不足 → 該当Stageを再実行
- manifest.json作成失敗 → 権限とディスク容量を確認

### 完了後の品質確認

**以下を確認してエクスポートの品質を保証してください：**
- [ ] manifest.jsonが正しく生成されている
- [ ] total_conversationsが実際の会話数と一致している
- [ ] filesセクションに全ての作成ファイルが記録されている
- [ ] 学習価値の高い体験として整理されている

