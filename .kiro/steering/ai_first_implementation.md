---
inclusion: always
---

# AIファースト実装ガイドライン

## 1. はじめに

### 1.1. 本ガイドラインの目的

このドキュメントは、AIエージェントが効率的かつ安全に動作できるシステムを構築するための、汎用的な設計指針を提供するものです。人間向けのUI/UX設計とは異なり、AIエージェントの特性（曖昧さを嫌い、構造化された情報を好むなど）を考慮した「AIファースト」な実装アプローチを定義します。

### 1.2. AIファースト設計の重要性

AIエージェントは、自律的にタスクを遂行する強力なパートナーですが、その能力を最大限に引き出すには、AIが「理解しやすく、予測可能で、学習しやすい」環境が必要です。AIファーストな設計は、AIの認知負荷を軽減し、エラー率を下げ、システムの安定性と自律性を向上させるための鍵となります。

## 2. 基本原則

AIファーストな実装は、以下の5つの基本原則に基づいています。

1.  **明確性 (Clarity)**
    曖昧な表現を避け、具体的で明示的な情報を提供します。AIが解釈に迷うことなく、確実に行動できるようにします。

2.  **構造化 (Structure)**
    情報を階層的かつ一貫性のあるフォーマットで提供します。AIが情報を効率的にパースし、パターンを認識できるようにします。

3.  **予測可能性 (Predictability)**
    処理の結果、副作用、所要時間などを事前に予測可能にします。AIが安全かつ計画的にタスクを実行できるようにします。

4.  **学習効率 (Learnability)**
    一貫したパターンを提供し、AIが過去の経験から学習して自己最適化できるような設計を目指します。

5.  **回復力 (Resilience)**
    エラーが発生した際に、AIが状況を理解し、自律的に回復できるような堅牢なエラーハンドリングを提供します。

## 3. 実装パターン

上記の基本原則を、具体的な実装に落とし込むためのパターンを以下に示します。

### 3.1. 情報提供 (Information Provisioning)

AIが行動を起こす前に、十分な判断材料を提供します。

#### パターン1: コンテキストの事前提供

ツールの説明やAPIの仕様には、AIが実行計画を立てるために必要な情報を網羅的に含めます。

```typescript
// ❌ 曖昧な説明
const processData = (data) => { /* ... */ };

// ✅ AIにとって親切な説明
const dataProcessingTool = {
  description: `データを処理します。
  
前提条件:
- 入力形式: JSON
- データサイズ上限: 10MB

処理時間目安:
- 1MB未満: 約10秒
- 1MB以上: 1分以上かかる可能性あり

出力形式:
- 処理結果のサマリーを含むJSONオブジェクト
  `,
  // ...
};
```

#### パターン2: 状態の可視化

現在のシステム状態を、AIがいつでも確認できるようにします。

```bash
# ❌ 状態が不明

# ✅ 構造化された状態表示
show_system_status() {
    echo "システム状態:"
    echo "- 現在のモード: processing"
    echo "- 利用可能メモリ: 2.5GB / 8.0GB"
    echo "- 待機中タスク: 3件"
}
```

### 3.2. 意思決定支援 (Decision Support)

AIに判断を委ねる際は、明確な選択肢と判断材料を提供します。

#### パターン3: 明確な選択肢の提示

曖昧な指示ではなく、具体的な選択肢を提示します。

```typescript
// ❌ 曖昧な指示
"エラーが発生しました。適切に対応してください。"

// ✅ 明確な選択肢
"エラーが発生しました。以下から選択してください:
1. 処理をリトライする (推奨)
2. 処理をスキップして続行する
3. 処理を中止する"
```

#### パターン4: リスクとトレードオフの明示

各選択肢に伴うリスクやメリット・デメリットを明記します。

```typescript
return {
  decision: "ファイルの保存方法を選択してください",
  options: [
    {
      name: "上書き保存",
      pros: ["シンプルで高速"],
      cons: ["元のデータが失われる"],
      risk: "中"
    },
    {
      name: "別名で保存",
      pros: ["安全性が高い"],
      cons: ["ファイル管理が複雑になる"],
      risk: "低"
    }
  ]
};
```

### 3.3. エラーハンドリング (Error Handling)

エラーは単なる失敗ではなく、AIにとっての学習機会です。

#### パターン5: 構造化されたエラー情報

エラーメッセージには、原因と解決策を構造化して含めます。

```typescript
// ❌ 単純なエラーメッセージ
throw new Error("処理に失敗しました");

// ✅ 構造化されたエラーオブジェクト
return {
  success: false,
  error: {
    type: "INVALID_INPUT_ERROR",
    message: "入力データの形式が不正です。",
    details: "必須項目 'user_id' が欠落しています。",
    suggestion: "入力データに 'user_id' を追加して再実行してください。",
    recoverable: true
  }
};
```

### 3.4. プロセス管理 (Process Management)

AIが実行するプロセスの透明性と制御性を高めます。

#### パターン6: 副作用の明示

システムの永続的な状態を変更するような処理には、その副作用を明確に警告します。

```typescript
const deleteResourceTool = {
  description: `リソースを削除します。
  
**警告: この操作は元に戻せません。**

副作用:
- データベースから関連レコードが完全に削除されます。
- 関連するファイルがストレージから削除されます。
  `,
  // ...
};
```

#### パターン7: 進捗の可視化

完了までに時間がかかる処理は、定期的に進捗を報告させます。

```typescript
function longRunningProcess(totalSteps) {
  for (let step = 1; step <= totalSteps; step++) {
    // ... 処理 ...
    const percentage = Math.round((step / totalSteps) * 100);
    console.log(`進捗: ${percentage}% (${step}/${totalSteps})`);
  }
}
```

### 3.5. 学習と最適化 (Learning and Optimization)

AIが自己改善できるような仕組みを組み込みます。

#### パターン8: 一貫性のあるパターン

APIのレスポンス形式、命名規則、ログ形式などを統一することで、AIはパターンを学習しやすくなります。

```json
// 統一されたAPIレスポンス形式
{
  "status": "success" | "warning" | "error",
  "message": "人間が読める説明",
  "data": { /* 構造化されたデータ */ },
  "metadata": { /* 実行情報 */ }
}
```

#### パターン9: フィードバックループ

処理結果に、パフォーマンスや改善のヒントを含めることで、AIの自己最適化を促します。

```typescript
return {
  success: true,
  performance: {
    executionTime: "1分15秒",
    memoryUsage: "128MB"
  },
  optimizationHints: [
    "入力をバッチ処理にすると、実行時間を約30%短縮できます。",
    "パラメータ 'fast_mode=true' を試してみてください。"
  ]
};
```

### 3.6. 絵文字の排除

#### パターン10: 非言語的表現の回避

絵文字やアイコンなどの非言語的表現は、AIにとって解釈が曖昧になる可能性があります。ステータスや意図は、明確なテキストで表現します。

```typescript
// ❌ 絵文字による曖昧な表現
"✅ 処理完了！ ⚠️ 注意が必要です"

// ✅ 明示的なテキスト表現
"処理完了。警告: 注意が必要です"
```

## 4. 実装チェックリスト

新しい機能やAPIを設計・実装する際に、以下の項目を確認してください。

### 設計段階
- [ ] AIにとっての目的は明確か？
- [ ] 必要な情報はすべて事前に提供されているか？
- [ ] 曖昧な判断を強いる部分はないか？
- [ ] エラーからの回復シナリオは考慮されているか？

### 実装段階
- [ ] 命名規則やレスポンス形式は一貫しているか？
- [ ] エラー情報は構造化されているか？
- [ ] 副作用は明示されているか？
- [ ] 長時間処理の進捗は可視化されているか？

### テスト段階
- [ ] AIがエラーメッセージから正しく回復できるか？
- [ ] AIが提供された情報だけで意思決定できるか？
- [ ] 曖昧な表現や解釈の余地がないか？

## 5. まとめ

AIファーストな実装とは、AIをシステムの「ユーザー」として捉え、その特性に最適化されたインターフェースと環境を提供することです。明確性、構造化、予測可能性を重視することで、AIエージェントの能力を最大限に引き出し、より高度で自律的なシステムの構築が可能になります。

このガイドラインが、あなたとAIエージェントとのより良い協調関係を築く一助となれば幸いです。
